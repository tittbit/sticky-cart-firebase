{%- comment -%}
This snippet fetches cart settings from your app's backend and makes them available to the cart drawer script.
Do not modify this file unless you are an advanced user.
{%- endcomment -%}

<script>
  (function() {
    async function fetchCartSettings() {
      try {
        const response = await fetch(`https://{your-app-proxy-url}/proxy/settings`);
        if (!response.ok) throw new Error('Failed to fetch settings');
        window.STICKY_CART_SETTINGS = await response.json();
        console.log('[Sticky Cart] Settings loaded successfully.');
      } catch (error) {
        console.error('[Sticky Cart] Error loading settings, using fallback:', error);
        // Fallback to default settings if the API call fails
        window.STICKY_CART_SETTINGS = {
          cartDrawerEnabled: {{ block.settings.enabled | default: true }},
          themeColor: '#3B82F6',
          stickyButton: {
            enabled: true,
            position: 'bottom-right',
            text: 'Cart'
          },
          freeShipping: {
            enabled: false,
            threshold: 100
          }
        };
      } finally {
        // Dispatch a custom event to notify that settings are loaded
        document.dispatchEvent(new CustomEvent('stickyCartSettingsLoaded'));
      }
    }

    // Only fetch settings if the cart drawer is enabled in the theme editor
    if ({{ block.settings.enabled | default: true }}) {
      fetchCartSettings();
    }
  })();
</script>
